# D2020 HOPI Combined Run File

# Variables

variable	timestep	index	0.25		# integration time step
variable  annealtime index 1000000
variable  name       index D2020_Pt
variable  dtdump     index   2500
variable  nrestart   index   0
variable  restartminusone   equal   ${nrestart}-1
variable  temp  index  353
variable  mu         index  -7.1

if "${nrestart} != 0" then &
"variable	data		index	after_anneal.rst" &
else &
"variable	data		index	${name}_edit.data" &

# Box Settings
units          real
atom_style     full
boundary       p p f

pair_style     lj/cut/coul/long 22.5 22.5
pair_modify    mix sixthpower
dielectric     1.0
special_bonds  lj 0.000000 0.000000 1.000000 coul 0.000000 0.000000 1.000000
bond_style     harmonic
angle_style    harmonic
dihedral_style charmm

if "${nrestart} != 0" then &
"read_restart ${data}" &
else &
"read_data ${data}" &


# Include Parameter File
include        D2020_1.8_Pt_dreiding.params

# Kspace Commands
kspace_style   pppm 0.00001
kspace_modify  slab 10.0

variable       maxpolymer    index    -5.0  # Find z bound of polymer

# Dump Commands
dump	         1 all yaml ${dtdump} ${name}_${nrestart}.yaml id type xu yu zu
dump	         2 all custom ${dtdump} ${name}_${nrestart}.lammpstrj id type xu yu zu
if "${nrestart} != 0" then "dump_modify 1 append yes"

# Modify Log/Thermo Output
thermo_style   custom etotal ke pe ebond eangle edihed eimp evdwl ecoul elong temp press vol
thermo_modify  line multi flush yes
thermo         1000
log	           log.lammps

# Neighbor List Modifications
neigh_modify   every 1 delay 0 check yes
neigh_modify   one 10000

# Set minimization specs
min_style      cg

# Create Groups and Freeze Selected atoms
group          pt    type 1
group          ox    type 8
group          notpt    type != 1
fix            frpt    pt   setforce 0.0 0.0 0.0

# Set Harmonic wall

fix wallhi all wall/harmonic zlo EDGE 622.609 0.000 4.0000 units box

# Write restart files
if "${nrestart} != 0" then "jump SELF simulate"

# Minimize
minimize       0.0 1.0e-8 10000 1000000


timestep       ${timestep}

# Anneal at 1000K
fix        	temp notpt langevin 1000.0 1000.0 100.0 723853
fix 	       int notpt nve/limit 0.1 
run 	       ${annealtime}
unfix          int
unfix          temp

# Drop from 1000K to 353K
fix        	temp notpt langevin 1000.0 353.0 100.0 723853
fix 	       int notpt nve/limit 0.1 
run 	       ${annealtime}
unfix          int
unfix          temp
write_data     after_anneal.data
write_restart  after_anneal.rst
label          simulate

# NVE Step
fix 	       int notpt nve 
run 	       ${annealtime}
unfix          int
write_data     after_nve.data
write_restart  after_nve.rst
label          simulate

# GCMC
dump           3 all xyz 500 ${name}_${nrestart}.xyz
molecule       oxygen oxygen.mol   # Molecule File
region         polyregion    block    EDGE EDGE EDGE EDGE 8.0 59.0     # Region for GCMC insertion
fix            oxgcmc   ox   gcmc   100  100  0  0  54341   ${temp} ${mu}   0.5  mol  oxygen &
               region  polyregion charge 0.0
restart        100 ${name}_11_${nrestart}.rst ${name}_12_${nrestart}.rst
delete_atoms overlap 1.5 ox all mol yes

# Set Integrator and modify to allow for variable number of atoms
fix 	         int all nvt temp  ${temp} ${temp} 100
compute_modify  int_temp     dynamic/dof yes
compute_modify  thermo_temp  dynamic/dof yes
variable	tacc equal f_oxgcmc[2]/(f_oxgcmc[1]+0.1)
variable	iacc equal f_oxgcmc[4]/(f_oxgcmc[3]+0.1)
variable	dacc equal f_oxgcmc[6]/(f_oxgcmc[5]+0.1)
variable	racc equal f_oxgcmc[8]/(f_oxgcmc[7]+0.1)
thermo_style   custom etotal ke pe press temp v_iacc v_dacc v_tacc v_racc
thermo_modify  line multi
run 	       2000000

write_data     ${name}_run.data


